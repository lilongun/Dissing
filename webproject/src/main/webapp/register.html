<!DOCTYPE HTML>
<html>
<head>
<title>Register</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
<script src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script src="jquery.confirm/jquery.confirm.js"></script>
<link rel="stylesheet" type="text/css" href="jquery.confirm/jquery.confirm.css" />
</head>
<body>
<div class="index-banner1">
  <div class="header-top">	
	<div class="wrap">
   		<div class="logo">
			<a href="index.html">
				<!--<img src="images/logo.png" alt=""/>-->
				<font size="6px" color="white">Dissing</font>
			</a>
		</div>	
		<div class="menu">																
			<a href="#" class="right_bt" id="activator"><img src="images/nav_icon.png" alt=""></a>
				<div class="box" id="box">
				  	<div class="box_content_center1">
					    <div class="menu_box_list1">
							<ul>
								<li><a href="index.html">Home</a></li>
								<li class="active"><a href="about.html">About</a></li> 
								<li><a href="blog.html">Blog</a></li> 
								<li><a href="gallery.html">Gallery</a></li>
								<li><a href="contact.html">Contact</a></li>
								<li><a href="404.html">404</a></li>
							</ul>
					     </div>
						 <a class="boxclose" id="boxclose"><img src="images/close.png" alt=""></a>
					 </div>                
			      </div>
			                 <script type="text/javascript">
								 /* 用途: 接收地直栏参数 取id=1 根据ID的值 */
                                 var urlinfo=window.location.href; //获取当前页面的url
                                 var len=urlinfo.length;//获取url的长度
                                 var offset=urlinfo.indexOf("?");//设置参数字符串开始的位置
                                 var newsidinfo=urlinfo.substr(offset+1,len)//取出参数字符串 这里会获得类似“id=1”这样的字符串
                                 var newsids=newsidinfo.split("=");//对获得的参数字符串按照“=”进行分割
                                 var newsname=newsids[0];//得到参数名字
                                 var userName = '';
								 if( newsname == 'user_name' ){
                                     userName = newsids[1];//得到参数值
								 }

								var $ = jQuery.noConflict();
									$(function() {
										$('#activator').click(function(){
												$('#box').animate({'top':'0px'},500);
										});
										$('#boxclose').click(function(){
												$('#box').animate({'top':'-700px'},500);
										});
									});
									$(document).ready(function(){
									
									//Hide (Collapse) the toggle containers on load
									$(".toggle_container").hide(); 
									
									//Switch the "Open" and "Close" state per click then slide up/down (depending on open/close state)
									$(".trigger").click(function(){
										$(this).toggleClass("active").next().slideToggle("slow");
										return false; //Prevent the browser jump to the link anchor
									});
									
									});
							</script>
			         </div>

		<div id="loginBox" style="float:right;margin-top: 11px;">

		</div>

		<script type="text/javascript">
            if( $.cookie("dissing_user_name") == null || $.cookie("access_token") == null ) {
                $('#loginBox').html('<a href="login.html"><font size="5px" color="white">登录</font></a>');
            }else{
				/*
				 $('#loginBox').html('<ul><li class="dropdown">' +
				 '<a href="register.html"><font size="5px" color="white">' + $.cookie("dissing_user_name") + '</font></a>' +
				 '<ul> <li><a href="#"><font size="4px" color="white">注销</font></a></li></ul>' +
				 '</li></ul>');
				 */
                $('#loginBox').html('<a href="register.html"><font size="5px" color="white">' + $.cookie("dissing_user_name") + '</font></a>' +
                    ' <font color="white">[</font><a href="javascript:logout()"><font size="4px" color="white">注销</font></a><font color="white">]</font>');
            }

            function logout(){
                $.confirm({
                    'title'		: '提示',
                    'message'	: '确定要注销当前用户吗？',
                    'buttons'	: {
                        '是'	: {
                            'class'	: 'blue',
                            'action': function(){
                                $.cookie("dissing_user_name", "", {expires: -1});
                                $.cookie("access_token", "", {expires: -1});
                                window.location.href = 'index.html';
                            }
                        },
                        '否': {
                            'class'	: 'gray',
                            'action': function(){}
                        }
                    }
                });

            }
		</script>
		<div class="clear"></div>
	  </div>
	</div>
	   </div>
   	   <div class="main">
   	      <div class="register_account">
          	<div class="wrap">
    	      <h4 class="title">创建一个新账户</h4>
    		   <form>
    			 <div class="col_1_of_2 span_1_of_2">
					 <input id="id" type="hidden" />
		   			 <div><input id="username" type="text" value="用户名" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '用户名';}"></div>
					 <div><input id="nickName" type="text" value="昵称" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '昵称';}"></div>
					 <div><input id="email" type="text" value="电子邮箱" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '电子邮箱';}"></div>
		    	 </div>
		    	  <div class="col_1_of_2 span_1_of_2">
					<div><input id="password" type="text" value="密码" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '密码';}"></div>
					<div><input id="phoneNumber" type="text" value="电话号码" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '电话号码';}"></div>
		    		<div><input id="address" type="text" value="地址" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '地址';}"></div>

		    		<!--<div><select id="country" name="country" onchange="change_country(this.value)" class="frm-field required">
		            <option value="null">Select a Country</option>
		            <option value="AX">Åland Islands</option>
		            <option value="AF">Afghanistan</option>
		            <option value="AL">Albania</option>
		            <option value="DZ">Algeria</option>
		            <option value="AS">American Samoa</option>
		            <option value="AD">Andorra</option>
		            <option value="AO">Angola</option>
		            <option value="AI">Anguilla</option>
		            <option value="AQ">Antarctica</option>
		            <option value="AG">Antigua And Barbuda</option>
		            <option value="AR">Argentina</option>
		            <option value="AM">Armenia</option>
		            <option value="AW">Aruba</option>
		            <option value="AU">Australia</option>
		            <option value="AT">Austria</option>
		            <option value="AZ">Azerbaijan</option>
		            <option value="BS">Bahamas</option>
		            <option value="BH">Bahrain</option>
		            <option value="BD">Bangladesh</option>
		            <option value="BB">Barbados</option>
		            <option value="BY">Belarus</option>
		            <option value="BE">Belgium</option>
		            <option value="BZ">Belize</option>
		            <option value="BJ">Benin</option>
		            <option value="BM">Bermuda</option>
		            <option value="BT">Bhutan</option>
		            <option value="BO">Bolivia</option>
		            <option value="BA">Bosnia and Herzegovina</option>
		            <option value="BW">Botswana</option>
		            <option value="BV">Bouvet Island</option>
		            <option value="BR">Brazil</option>
		            <option value="IO">British Indian Ocean Territory</option>
		            <option value="BN">Brunei</option>
		            <option value="BG">Bulgaria</option>
		            <option value="BF">Burkina Faso</option>
		            <option value="BI">Burundi</option>
		            <option value="KH">Cambodia</option>
		            <option value="CM">Cameroon</option>
		            <option value="CA">Canada</option>
		            <option value="CV">Cape Verde</option>
		            <option value="KY">Cayman Islands</option>
		            <option value="CF">Central African Republic</option>
		            <option value="TD">Chad</option>
		            <option value="CL">Chile</option>
		            <option value="CN">China</option>
		            <option value="CX">Christmas Island</option>
		            <option value="CC">Cocos (Keeling) Islands</option>
		            <option value="CO">Colombia</option>
		            <option value="KM">Comoros</option>
		            <option value="CG">Congo</option>
		            <option value="CD">Congo, Democractic Republic</option>
		            <option value="CK">Cook Islands</option>
		            <option value="CR">Costa Rica</option>
		            <option value="CI">Cote D'Ivoire (Ivory Coast)</option>
		            <option value="HR">Croatia (Hrvatska)</option>
		            <option value="CU">Cuba</option>
		            <option value="CY">Cyprus</option>
		            <option value="CZ">Czech Republic</option>
		            <option value="DK">Denmark</option>
		            <option value="DJ">Djibouti</option>
		            <option value="DM">Dominica</option>
		            <option value="DO">Dominican Republic</option>
		            <option value="TP">East Timor</option>
		            <option value="EC">Ecuador</option>
		            <option value="EG">Egypt</option>
		            <option value="SV">El Salvador</option>
		            <option value="GQ">Equatorial Guinea</option>
		            <option value="ER">Eritrea</option>
		            <option value="EE">Estonia</option>
		            <option value="ET">Ethiopia</option>
		            <option value="FK">Falkland Islands (Islas Malvinas)</option>
		            <option value="FO">Faroe Islands</option>
		            <option value="FJ">Fiji Islands</option>
		            <option value="FI">Finland</option>
		            <option value="FR">France</option>
		            <option value="FX">France, Metropolitan</option>
		            <option value="GF">French Guiana</option>
		            <option value="PF">French Polynesia</option>
		            <option value="TF">French Southern Territories</option>
		            <option value="GA">Gabon</option>
		            <option value="GM">Gambia, The</option>
		            <option value="GE">Georgia</option>
		            <option value="DE">Germany</option>
		            <option value="GH">Ghana</option>
		            <option value="GI">Gibraltar</option>
		            <option value="GR">Greece</option>
		            <option value="GL">Greenland</option>
		            <option value="GD">Grenada</option>
		            <option value="GP">Guadeloupe</option>
		            <option value="GU">Guam</option>
		            <option value="GT">Guatemala</option>
		            <option value="GG">Guernsey</option>
		            <option value="GN">Guinea</option>
		            <option value="GW">Guinea-Bissau</option>
		            <option value="GY">Guyana</option>
		            <option value="HT">Haiti</option>
		            <option value="HM">Heard and McDonald Islands</option>
		            <option value="HN">Honduras</option>
		            <option value="HK">Hong Kong S.A.R.</option>
		            <option value="HU">Hungary</option>
		            <option value="IS">Iceland</option>
		            <option value="IN">India</option>
		            <option value="ID">Indonesia</option>
		            <option value="IR">Iran</option>
		            <option value="IQ">Iraq</option>
		            <option value="IE">Ireland</option>
		            <option value="IM">Isle of Man</option>
		            <option value="IL">Israel</option>
		            <option value="IT">Italy</option>
		            <option value="JM">Jamaica</option>
		            <option value="JP">Japan</option>
		            <option value="JE">Jersey</option>
		            <option value="JO">Jordan</option>
		            <option value="KZ">Kazakhstan</option>
		            <option value="KE">Kenya</option>
		            <option value="KI">Kiribati</option>
		            <option value="KR">Korea</option>
		            <option value="KP">Korea, North</option>
		            <option value="KW">Kuwait</option>
		            <option value="KG">Kyrgyzstan</option>
		            <option value="LA">Laos</option>
		            <option value="LV">Latvia</option>
		            <option value="LB">Lebanon</option>
		            <option value="LS">Lesotho</option>
		            <option value="LR">Liberia</option>
		            <option value="LY">Libya</option>
		            <option value="LI">Liechtenstein</option>
		            <option value="LT">Lithuania</option>
		            <option value="LU">Luxembourg</option>
		            <option value="MO">Macau S.A.R.</option>
		            <option value="MK">Macedonia</option>
		            <option value="MG">Madagascar</option>
		            <option value="MW">Malawi</option>
		            <option value="MY">Malaysia</option>
		            <option value="MV">Maldives</option>
		            <option value="ML">Mali</option>
		            <option value="MT">Malta</option>
		            <option value="MH">Marshall Islands</option>
		            <option value="MQ">Martinique</option>
		            <option value="MR">Mauritania</option>
		            <option value="MU">Mauritius</option>
		            <option value="YT">Mayotte</option>
		            <option value="MX">Mexico</option>
		            <option value="FM">Micronesia</option>
		            <option value="MD">Moldova</option>
		            <option value="MC">Monaco</option>
		            <option value="MN">Mongolia</option>
		            <option value="ME">Montenegro</option>
		            <option value="MS">Montserrat</option>
		            <option value="MA">Morocco</option>
		            <option value="MZ">Mozambique</option>
		            <option value="MM">Myanmar</option>
		            <option value="NA">Namibia</option>
		            <option value="NR">Nauru</option>
		            <option value="NP">Nepal</option>
		            <option value="NL">Netherlands</option>
		            <option value="AN">Netherlands Antilles</option>
		            <option value="NC">New Caledonia</option>
		            <option value="NZ">New Zealand</option>
		            <option value="NI">Nicaragua</option>
		            <option value="NE">Niger</option>
		            <option value="NG">Nigeria</option>
		            <option value="NU">Niue</option>
		            <option value="NF">Norfolk Island</option>
		            <option value="MP">Northern Mariana Islands</option>
		            <option value="NO">Norway</option>
		            <option value="OM">Oman</option>
		            <option value="PK">Pakistan</option>
		            <option value="PW">Palau</option>
		            <option value="PS">Palestinian Territory, Occupied</option>
		            <option value="PA">Panama</option>
		            <option value="PG">Papua new Guinea</option>
		            <option value="PY">Paraguay</option>
		            <option value="PE">Peru</option>
		            <option value="PH">Philippines</option>
		            <option value="PN">Pitcairn Island</option>
		            <option value="PL">Poland</option>
		            <option value="PT">Portugal</option>
		            <option value="PR">Puerto Rico</option>
		            <option value="QA">Qatar</option>
		            <option value="RE">Reunion</option>
		            <option value="RO">Romania</option>
		            <option value="RU">Russia</option>
		            <option value="RW">Rwanda</option>
		            <option value="SH">Saint Helena</option>
		            <option value="KN">Saint Kitts And Nevis</option>
		            <option value="LC">Saint Lucia</option>
		            <option value="PM">Saint Pierre and Miquelon</option>
		            <option value="VC">Saint Vincent And The Grenadines</option>
		            <option value="WS">Samoa</option>
		            <option value="SM">San Marino</option>
		            <option value="ST">Sao Tome and Principe</option>
		            <option value="SA">Saudi Arabia</option>
		            <option value="SN">Senegal</option>
		         </select></div>
		          <div><input type="text" value="City" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '';}"></div>
		           <input type="text" value="" class="code"> - <input type="text" value="" class="number">
		           <p class="code">Country Code + Phone Number</p>-->
		       </div>
		      <!--<button id="submitButton" class="grey">提交</button>-->
				   <input id="submitButton" class="grey" type="button" value="提交">
				   <script>
                       if( $.cookie("dissing_user_name") != null && $.cookie("access_token") != null ){
                           $('#username').attr("disabled","disabled");

                           $.ajax({
                               url: 'http://localhost:9099/auth/currentUser?access_token='+$.cookie("access_token"),
                               dataType: "json",
                               async: false,
							   headers: {
								"Authorization": "Basic " + btoa("dissing" + ":" + "dissing")
								},
                               type: "GET",
                               success:function (data) {
                                   if(data == null || data == '' || data == undefined){
                                       $.confirm({
                                           'title'		: '提示',
                                           'message'	: '抱歉，服务器错误！',
                                           'buttons'	: {
                                               'OK': {
                                                   'class'	: 'gray',
                                                   'action': function(){}
                                               }
                                           }
                                       });
                                       return;
                                   }else{
                                       $('#id').val(data.id);
                                       $('#username').val(data.username);
                                       $('#password').val('修改密码');
                                       if( data.nickName != null && data.nickName != '' ){
                                           $('#nickName').val(data.nickName);
									   }
                                       if( data.email != null && data.email != '' ) {
                                           $('#email').val(data.email);
                                       }
                                       if( data.imageUrl != null && data.imageUrl != '' ) {
                                           $('#imageUrl').val(data.imageUrl);
                                       }
                                       if( data.phoneNumber != null && data.phoneNumber != '' ) {
                                           $('#phoneNumber').val(data.phoneNumber);
                                       }
                                       if( data.address != null && data.address != '' ) {
                                           $('#address').val(data.address);
                                       }
                                   }
                               },
                               error:function(){
                                   $.confirm({
                                       'title'		: '提示',
                                       'message'	: '抱歉，服务器错误！',
                                       'buttons'	: {
                                           'OK': {
                                               'class'	: 'gray',
                                               'action': function(){}
                                           }
                                       }
                                   });
                               }
                           });
					   }

                       $('#submitButton').click(function(){
                           var id = null;
                           var username = $('#username').val();
                           if( $.cookie("dissing_user_name") != null && $.cookie("access_token") != null ) {
                               id = $('#id').val();
						   }
                           var password = $('#password').val();
                           var nickName = $('#nickName').val();
                           var email = $('#email').val();
                           var imageUrl = $('#imageUrl').val();
                           var phoneNumber = $('#phoneNumber').val();
                           var address = $('#address').val();

                           var json = {
                               "id":id,
                               "username":username,
                               "password":password,
                               "nickName":nickName,
                               "email":email,
                               "imageUrl":imageUrl,
                               "phoneNumber":phoneNumber,
                               "address":address
                           };

                           if(username == ''){
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '请输入用户名！',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           } else if(!/^[A-Za-z0-9_-]+$/.test(username)) {
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '对不起，用户名只能包含英文大小写或数字或下划线以及横杠',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           } else if(password == ''){
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '请输入密码！',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           }else if(!/^[A-Za-z0-9!@$*_\-()=.\[\]?,]+$/.test(password)) {
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '对不起，密码只能包含英文大小写或数字以及如下字符!@$*_-()=.[]?,',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           }else if(!/^[0-9-]+$/.test(phoneNumber)) {
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '对不起，电话号码只能包含数字或横杠',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           }else if(!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(email)) {
                               $.confirm({
                                   'title'		: '提示',
                                   'message'	: '对不起，电子邮箱格式不正确',
                                   'buttons'	: {
                                       'OK': {
                                           'class'	: 'gray',
                                           'action': function(){}
                                       }
                                   }
                               });
                               return;
                           }


                           if( $.cookie("dissing_user_name") == null || $.cookie("access_token") == null ) {
							   $.ajax({
								   url: 'http://localhost:9099/auth/registerUser',
								   dataType: "text",
								   async: false,
								   contentType: "application/json; charset=utf-8",
								   /*headers: {
									   "Authorization": "Basic " + btoa("dissing" + ":" + "dissing")
								   },*/
								   type: "PUT",
								   data: JSON.stringify(json),
								   success:function (data) {
									   if(data == null || data == '' || data == undefined || data == 'fail'){
										   $.confirm({
											   'title'		: '提示',
											   'message'	: '抱歉，服务器错误！',
											   'buttons'	: {
												   'OK': {
													   'class'	: 'gray',
													   'action': function(){}
												   }
											   }
										   });
										   return;
									   }else if( data == 'success' ){
										   $.confirm({
											   'title'		: '提示',
											   'message'	: '注册成功，将要跳转到首页！',
											   'buttons'	: {
												   'OK': {
													   'class'	: 'gray',
													   'action': function(){window.location.href = 'index.html';}
												   }
											   }
										   });
										   return;
									   }else if( data == 'repeated' ){
										   $.confirm({
											   'title'		: '提示',
											   'message'	: '抱歉，用户名已被注册，请重新输入！',
											   'buttons'	: {
												   'OK': {
													   'class'	: 'gray',
													   'action': function(){}
												   }
											   }
										   });
										   return;
									   }
								   },
								   error:function(){
									   $.confirm({
										   'title'		: '提示',
										   'message'	: '抱歉，服务器错误！',
										   'buttons'	: {
											   'OK': {
												   'class'	: 'gray',
												   'action': function(){}
											   }
										   }
									   });
								   }
							   });
                           }else{
                               $.ajax({
                                   url: 'http://localhost:9099/auth/updateUser?access_token='+$.cookie("access_token"),
                                   dataType: "text",
                                   async: false,
                                   contentType: "application/json; charset=utf-8",
								   /*headers: {
									"Authorization": "Basic " + btoa("dissing" + ":" + "dissing")
									},*/
                                   type: "POST",
                                   data: JSON.stringify(json),
                                   success:function (data) {
                                       if(data == null || data == '' || data == undefined || data == 'fail'){
                                           $.confirm({
                                               'title'		: '提示',
                                               'message'	: '抱歉，服务器错误！',
                                               'buttons'	: {
                                                   'OK': {
                                                       'class'	: 'gray',
                                                       'action': function(){}
                                                   }
                                               }
                                           });
                                           return;
                                       }else if( data == 'success' ){
                                           $.confirm({
                                               'title'		: '提示',
                                               'message'	: '修改成功！',
                                               'buttons'	: {
                                                   'OK': {
                                                       'class'	: 'gray',
                                                       'action': function(){}
                                                   }
                                               }
                                           });
                                           return;
                                       }
                                   },
                                   error:function(){
                                       $.confirm({
                                           'title'		: '提示',
                                           'message'	: '抱歉，服务器错误！',
                                           'buttons'	: {
                                               'OK': {
                                                   'class'	: 'gray',
                                                   'action': function(){}
                                               }
                                           }
                                       });
                                   }
                               });
						   }
                       });

				   </script>
		    <!--<p class="terms">By clicking 'Create Account' you agree to the <a href="#">Terms &amp; Conditions</a>.</p>-->
		    <div class="clear"></div>
		    </form>
    	</div>
      </div>
   	 </div>
   	 <div class="footer">
	   	<div class="wrap">
	   		<div class="copy">
			   <p>Copyright &copy; 2018.dissing.cn All rights reserved.</p>
		    </div>
	   	</div>
    </div>
<div style="display:none"><script src='http://v7.cnzz.com/stat.php?id=155540&web_id=155540' language='JavaScript' charset='gb2312'></script></div>
</body>
</html>